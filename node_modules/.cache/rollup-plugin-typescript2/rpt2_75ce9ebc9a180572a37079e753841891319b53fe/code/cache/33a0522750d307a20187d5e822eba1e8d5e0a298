{"code":"import { hasChange, isArray, isObject } from \"@iVue/shared\";\r\nimport { reactive } from \"./reactive\";\r\nimport { track, trigger } from \"./effect\";\r\nvar convert = function (val) { return isObject(val) ? reactive(val) : val; };\r\nvar RefImpl = /** @class */ (function () {\r\n    function RefImpl(rawValue) {\r\n        this.__v_isRef = true;\r\n        this._rawValue = rawValue;\r\n        this._value = rawValue;\r\n    }\r\n    Object.defineProperty(RefImpl.prototype, \"value\", {\r\n        get: function () {\r\n            // 依赖收集 {this:{value:[effect,effect]}}\r\n            track(this, 'value'); // depend\r\n            return this._value;\r\n        },\r\n        set: function (newValue) {\r\n            // 如果值有变化再去触发更新，如果值没发生变化 就不要再次触发更新了\r\n            if (hasChange(newValue, this._rawValue)) {\r\n                // 修改值，同时触发收集的effect\r\n                this._value = convert(newValue);\r\n                trigger(this, 'set', 'value'); // notify\r\n            }\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    return RefImpl;\r\n}());\r\nexport function ref(rawValue) {\r\n    return new RefImpl(rawValue);\r\n}\r\nvar ObjectRefImpl = /** @class */ (function () {\r\n    function ObjectRefImpl(object, key) {\r\n        this.object = object;\r\n        this.key = key;\r\n    }\r\n    Object.defineProperty(ObjectRefImpl.prototype, \"value\", {\r\n        // 通过类的属性访问器完成 代理\r\n        get: function () {\r\n            return this.object[this.key];\r\n        },\r\n        set: function (newValue) {\r\n            this.object[this.key] = newValue;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    return ObjectRefImpl;\r\n}());\r\nexport function toRefs(object) {\r\n    var result = isArray(object) ? new Array(object.length) : {};\r\n    for (var key in object) {\r\n        result[key] = new ObjectRefImpl(object, key);\r\n    }\r\n    return result;\r\n}\r\n","references":["/Users/bingyang/Documents/festudy/my-vue3/packages/shared/src/index.ts","/Users/bingyang/Documents/festudy/my-vue3/packages/reactivity/src/reactivity/reactive.ts","/Users/bingyang/Documents/festudy/my-vue3/packages/reactivity/src/reactivity/effect.ts"]}
